# 설계 문서

## 1. Introduction

### 1.1 목적(Purpose)

본 문서의 목적은 미디어 콘텐츠 재생 프로그램의 서버와 데이터베이스에 대한 아키텍처 설계를 제공하는 것이다. 사용자 로그 및 미디어 콘텐츠 데이터를 수집, 관리 및 처리하기 위한 요구 사항과 미디어 콘텐츠 재생 중에 이 데이터를 추출하고 전송하기 위한 클라이언트 프로그램의 요구 사항도 개략적으로 설명한다.

본 문서는 미디어 재생 데이터 및 로그 관리 프로그램을 설계, 구현 및 관리하기 위한 기술 가이드 역할을 한다. 주요 구성 요소, 그 상호 작용 및 시스템 내의 데이터 흐름을 강조하는 아키텍처에 대한 자세한 개요를 제공한다. 또한 미디어 콘텐츠 재생 프로그램의 개발 및 유지관리에 관여하는 개발자, 이해관계자 및 시스템 관리자를 위한 참조 자료로 사용될 수 있다.

### 1.2 범위(Scope)

본 문서의 범위는 미디어 콘텐츠 재생 프로그램의 서버와 데이터베이스의 기능 요구사항(Functional Requirements), 비기능 요구사항(Non-Functional Requirements) 및 데이터 설계(Data Design)로 한정한다.

### 1.3. 용어 및 정의(Terminologies and Definitions)

- Adaptive (Bitrate) Streaming : 소스 콘텐츠가 여러 비트레이트로 인코딩되는, HTTP 경유 비디오 스트리밍 방식의 하나이다.

- Node.JS : 구글 크롬의 자바스크립트 엔진(V8 Engine)에 기반해 만들어진 서버 사이드 플랫폼으로 확장성이 있는 네트워크 애플리케이션 개발에 사용된다.

- MySQL : 오픈 소스 관계형 데이터베이스 관리 시스템(RDBMS)으로, 고성능, 안정성, 확장성, 사용 편의성 등 다양한 장점을 가지고 있어 데이터베이스 구축 및 관리에 널리 사용된다.

- API : Application Programming Interface의 약자이다. 일종의 소프트웨어 인터페이스이며 컴퓨터나 소프트웨어 간 연결을 가능하게 한다.

- 클라이언트 : 서버와 통신할 대상이며, 서버에게 미디어 콘텐츠와 관련된 각종 요청을 한다.

---

## 2. Architectural Drivers

### 2.1 유스케이스 다이어그램(Usecase Diagram)

![usecase](https://github.com/kim2ju/connected_platform-term_project/assets/84396632/19274b32-d51d-42e2-bc1e-6e2caa6befe4)

### 2.2. 기능 요구사항(Functional Requirements)

| ID | Function | Description |
| :-: | :-: | --- |
| FR01 | 회원가입 | 1. 클라이언트에서 이메일, 비밀번호, 성별, 나이, 닉네임을 입력하여 서버에 사용자 등록을 요청한다. <br /> 2. 비밀번호를 암호화한 후 사용자 정보를 데이터베이스에 저장한다. <br /> 3-1. 만약 이미 데이터베이스에 저장되어 있는 이메일이라면 사용자 정보를 저장하지 않고 잘못된 요청임을 클라이언트에 회신한다. <br /> 3-2. 데이터베이스에 성공적으로 저장되면 성공했음을 클라이언트에 회신한다. <br /> 4. 만약 클라이언트가 성공적으로 사용자 정보를 저장했다고 회신 받으면 입력했던 이메일, 비밀번호로 서버에 로그인을 요청한다. |
| FR02 | 로그인 | 1. 클라이언트에서 이메일, 비밀번호를 입력하여 서버에 로그인을 요청한다. <br /> 2. 데이터베이스에 이메일이 존재하는지 조회한다. <br /> 3-1. 존재하지 않는다면 잘못된 요청임을 클라이언트에 회신한다. <br /> 3-2. 존재한다면 비밀번호가 같은지 확인한다. <br /> 4-1. 비밀번호가 다르다면 잘못된 요청임을 클라이언트에 회신한다. <br /> 4-2. 비밀번호가 같다면 사용자 정보와 사용자 유효성 확인을 위한 토큰 값을 회신한다. |
| F403 | 사용자 정보 제공 | 1. 클라이언트에 저장되어 있는 토큰 값으로 서버에 사용자 정보를 요청한다. <br /> 2. 유효한 토큰 값이면 토큰에서 사용자 ID를 얻는다. 3. 데이터베이스에서 사용자 ID로 정보를 조회한다. 4-1. 존재하지 않는 ID라면 잘못된 요청임을 클라이언트에 회신한다. 4-2. 존재한다면 사용자 정보를 클라이언트에 회신한다. |
| FR04 | 로그아웃 | 1. 클라이언트에 저장되어 있는 토큰 값으로 서버에 로그아웃을 요청한다. <br /> 2. 유효한 토큰 값이면 클라이언트에 유효한 요청임을 회신한다. |
| FR05 | 회원 탈퇴 | 1. 클라이언트에 저장되어 있는 토큰 값으로 서버에 회원 탈퇴를 요청한다. <br /> 2, 유효한 토큰 값이면 토큰에서 사용자 ID를 얻는다. <br /> 3. 데이터베이스에서 사용자 ID로 사용자 정보를 삭제한다. <br /> 4. 요청이 성공했음을 클라이언트에 회신한다. |  
| FR06 | 장르별 미디어 콘텐츠 조회 | 1. 클라이언트에서 서버에 원하는 장르의 미디어 콘텐츠 목록을 요청한다. <br /> 2. 데이터베이스에서 요청받은 장르에 해당하는 미디어 콘텐츠를 조회한다. <br /> 3. 클라이언트에 미디어 콘텐츠 목록을 회신한다. |
| FR07 | 인기 미디어 콘텐츠 조회 | 1. 클라이언트에서 서버에 추천 수가 많은 미디어 콘텐츠 목록을 요청한다. <br /> 2. 데이터베이스에서 추천 수가 0보다 많은 콘텐츠를 조회하여 추천 수 기준 내림차순으로 정렬한다. <br /> 3. 클라이언트에 미디어 콘텐츠 목록을 회신한다. |
| FR08 | 사용자 미디어 콘텐츠 추천 | 1. 클라이언트에서 토큰 값과 함께 서버에 사용자 맞춤형 미디어 콘텐츠 목록을 요청한다. <br /> 2-1. 유효하지 않은 토큰 값이면 클라이언트에 비어있는 리스트를 회신한다. <br /> 2-2. 유효한 토큰 값이면 토큰에서 사용자 ID를 얻는다. <br /> 3. 데이터베이스에서 장르별 미디어 콘텐츠 시청 횟수를 조회한다. <br /> 4. 가장 많이 시청한 장르의 미디어 콘텐츠 목록을 클라이언트에 회신한다. 만약, 많이 시청한 장르가 여러 개라면 그중 2개의 장르를 랜덤하게 뽑아 2개의 장르에 동시에 속하는 미디어 콘텐츠 목록을 클라이언트에 회신한다. |
| FR09 | 사용자가 좋아한 미디어 콘텐츠 조회 | 1. 클라이언트에서 토큰 값과 함께 서버에 사용자 맞춤형 미디어 콘텐츠 목록을 요청한다. <br /> 2-1. 유효하지 않은 토큰 값이면 클라이언트에 비어있는 리스트를 회신한다. <br /> 2-2. 유효한 토큰 값이면 토큰에서 사용자 ID를 얻는다. <br /> 3. 데이터베이스에서 사용자가 추천을 한 미디어 콘텐츠를 조회한다. <br /> 4. 클라이언트에 미디어 콘텐츠 목록을 회신한다. |
| FR10 | 미디어 콘텐츠 검색 | 1. 클라이언트에서 검색할 단어를 입력하여 서버에 미디어 콘텐츠를 조회한다. <br /> 2. 데이터베이스에서 전달받은 단어를 제목에 포함하고 있는 미디어 콘텐츠를 조회한다. <br /> 클라이언트에 미디어 콘텐츠 목록을 회신한다. |
| FR11 | 미디어 콘텐츠 상세 조회 | 1. 클라이언트에서 미디어 콘텐츠의 ID 값으로 상세 정보를 요청한다. <br /> 2. 데이터베이스에서 미디어 콘텐츠 ID로 정보를 조회한다. <br /> 3. 클라이언트에 미디어 콘텐츠 상세 정보를 회신한다. |
| FR12 | 미디어 콘텐츠 시청 기록 저장 | 1. 클라이언트에서 토큰 값과 함께 시청 기록 저장을 요청한다. <br /> 2-1. 데이터베이스에 시청 기록이 존재한다면 기존의 시청 기록에서 시청 시간만 업데이트한다. <br /> 2-2. 시청 기록이 존재하지 않는다면 데이터베이스에 시청 기록을 저장하고 사용자가 시청한 장르 정보를 업데이트한다. |
| FR13 | 미디어 콘텐츠 시청 기록 조회 | 1. 클라이언트에서 토큰 값과 미디어 콘텐츠의 ID 값으로 상세 정보를 요청한다. <br /> 2. 유효한 토큰 값이라면 토큰에서 사용자 ID를 얻는다. <br /> 3. 데이터베이스에서 시청 기록이 존재하는지 조회한다. <br /> 4. 클라이언트에 미디어 콘텐츠의 상세 정보와 함께 시청 기록을 회신한다. | 
| FR14 | 미디어 콘텐츠 좋아요 기록 저장 | 1. 클라이언트에서 토큰 값과 미디어 콘텐츠 ID로 좋아요 기록 저장을 요청한다. <br /> 2-1. 데이터베이스에 좋아요 기록이 있다면 데이터베이스에서 해당 기록을 삭제한다. <br /> 2-2. 데이터베이스에 기록이 없다면 사용자 ID와 미디어 콘텐츠 ID로 좋아요 기록을 저장한다. <br /> 3. 클라이언트에 요청이 성공했음을 회신한다. |
| FR15 | 실시간 채팅 | 1. 클라이언트에서 서버에 메시지를 전송한다. <br /> 2. 서버에서 같은 채팅방에 있는 다른 클라이언트들에게 메시지를 전송한다. 3. 다른 클라이언트들은 실시간으로 메시지를 받아 화면에 보여준다. | 
| FR16 | 미디어 시청 품질 로그 저장 | 1. 클라이언트에서 토큰 값과 시청 품질 로그 데이터로 로그 저장을 요청한다. <br /> 2. 서버는 메모리에 로그를 저장한다. <br /> 3. 클라이언트에 요청이 성공했음을 회신한다. <br /> 4. 서버는 주기적으로 CSV파일에 메모리에 쌓인 로그를 저장한다. |
| FR17 | 시청 품질 로그 시각화 | 1. 클라이언트(관리자)는 시각화 대상 CSV 파일과 대상 Timestamp 범위를 지정한다. <br /> 2. 서버는 그에 따라 시청 품질 로그 데이터를 산점도나 꺾은선 그래프의 형태로 클라이언트에게 보여줄 수 있도록 한다. |

### 2.3 비기능 요구사항(Non-Functional Requirements)

#### 2.3.1. 품질 요구사항(Quality Attribute)

| ID | Category | Description |
| :-: | :-: | --- |
| QA01-1 | 성능 | 서버는 동시에 다수의 클라이언트의 데이터 요청을 처리해야 한다. |
| QA01-2 | 성능 | 미디어 함께 보기 기능에서 방에 접속한 클라이언트 간의 latency가 1초 미만이어야 한다. |
| QA02 | 사용성 | 미디어 콘텐츠 시청 기록을 저장하여 콘텐츠 시청을 개인화하여야 한다. |
| QA03 | 보안 | 사용자 인증을 통해 사용자의 정보를 보호해야 한다. |




#### 2.3.2. 제약 사항(Constraint Requirement)

| ID | Description |
| :-: | --- |
| CR01 | 본 프로젝트의 완성 기한은 2023.06.05이다. |

---

## 3. Architecture Overview

![image](https://github.com/kim2ju/connected_platform-term_project/assets/49589140/99def5b7-1b13-424c-abd9-4ce8511d4e85)


### 3.1 Frontend Architecture

- 유저 인터페이스 
  - 화면, 페이지, 양식 및 미디어 콘텐츠 표시를 포함하여 사용자 인터페이스 요소를 렌더링한다.
  - 사용자가 플랫폼을 탐색하고 상호 작용할 수 있도록 직관적이고 시각적으로 매력적인 디자인을 제공한다.

- 사용자 입력 처리
  - UI 구성 요소에서 사용자 입력을 받는다.
  - 백엔드로 요청을 보내기 전에 사용자 입력의 유효성을 검사하고 처리한다.

- 사용자 인증 및 권한 부여
  - 사용자 등록 및 로그인 프로세스를 관리한다.
  - 사용자 등록과 인증 및 권한 부여를 위해 백엔드와 통신한다.
  - 사용자 권한 정보를 저장한다.

- 미디어 콘텐츠 표시
  - 미디어 콘텐츠 목록과 콘텐츠 항목에 대한 세부 정보를 표시한다.
  - 미디어 재생 설정 및 콘텐츠에 대한 좋아요 등의 사용자 상호 작용을 제공한다.  

### 3.2 Backend Architecture

- API 요청 처리
  - 프론트엔드와의 통신을 위해 RESTful API를 정의한다.
  - 프론트엔드에서 들어오는 요청을 처리하고 결과를 회신한다.

- 사용자 관리
  - 사용자 등록, 인증 및 권한 부여를 관리한다.
  - 사용자의 정보를 저장하고 암호화 및 유효성 검사를 처리합니다.
  - 보안 통신을 인증 토큰을 관리한다.

- 미디어 콘텐츠 관리
  - 제목, 설명, 장르 등의 미디어 콘텐츠 데이터를 저장하고 관리한다.
  - 콘텐츠 검색 및 세부 정보에 대한 API를 제공한다.

- 미디어 콘텐츠 맞춤형 추천
  - 사용자 시청 기록을 분석하여 개인화된 콘텐츠 선호도를 파악한다.
  - 장르 추천 모델을 활용하여 관련 미디어 콘텐츠를 사용자에게 제안한다.

- 데이터베이스 관리
  - 사용자, 미디어 콘텐츠와 관련된 데이터를 저장하고 관리한다.
  - 시스템의 기능을 지원하는 효율적인 데이터 저장 및 검색 메커니즘을 제공한다.
  - 많은 수의 사용자 및 미디어 콘텐츠 항목을 처리할 수 있도록 데이터 무결성, 보안 및 확장성을 보장한다.

---

## 4. Data Design

![Data model](https://github.com/kim2ju/connected_platform-term_project/assets/84396632/59f2410a-d2bd-4359-8ed8-d25da9f5c555)

### User Table
- 이 테이블에는 사용자 ID, 이메일, 암호화된 암호, 성별, 나이, 닉네임, 장르별 시청 횟수 정보를 저장한다.
- Columns
  - id
  - email
  - password
  - gender
  - age
  - nickname
  - Action
  - Adventure
  - Animation
  - Comedy
  - Crime
  - Documentary
  - Drama
  - Family
  - Fantasy
  - History
  - Horror
  - Music
  - Mystery
  - Romance
  - Science Fiction
  - TV Movie
  - Thriller
  - War
  - Western

### Video Table
- 이 테이블에는 미디어 콘텐츠 ID, 제목, url, 줄거리, 영상의 길이, 장르, 썸네일 url, 유튜브 url 정보를 저장한다.
- Columns
  - id
  - title
  - url
  - summary
  - duration
  - genre
  - thumbnailUrl
  - youtubeUrl

### User Watch Table
- 이 테이블에는 유저의 시청 기록을 저장한다.
- Columns
  - user_id (User Table의 id)
  - video_id (Video Table의 id)
  - duration

### Video Recommend Table
- 이 테이블에는 유저의 미디어 콘텐츠 추천 기록을 저장한다.
- Columns
  - user_id (User Table의 id)
  - video_id (Video Table의 id) 






